services:
  - type: web
    name: arc-nova-demo
    runtime: node
    plan: pro
    region: oregon
    buildCommand: |
      curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
      source $HOME/.cargo/env
      rustup default stable
      cd sonobe
      cargo build --release -p folding-schemes --example compliance_nova_stdio
      cargo build --release -p folding-schemes --example compliance_groth16_stdio
      cd ../demo
      npm ci
      npm run build
    startCommand: cd demo && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: RAYON_NUM_THREADS
        value: "4"
      - key: MALLOC_ARENA_MAX
        value: "2"
      - key: PORT
        value: "3000"
    healthCheckPath: /
