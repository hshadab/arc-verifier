Arc Verifier Repository Audit

Scope: Identify what’s real vs. mocked, key gaps, and safe cleanup/fixes.

Summary
- Real
  - Nova/Sonobe proofs for Liquidity: fund-proof.calldata and FundLiquidityVerifier.sol are generated by Sonobe examples (BN254, KZG10, Groth16 compression). A deployed verifier address is referenced and the fund contract integrates via an interface.
  - ZK circuits (Rust) for position limit, liquidity, whitelist, and range proofs using bellpepper with unit tests.
  - Solidity fund manager contract (Foundry) with 10 tests using a mock verifier for local testing.

- Mocked/Simulated
  - Position limit and whitelist verification in Solidity are placeholders (only non-empty check). No on-chain verifiers wired yet.
  - Demo UI simulates proof generation/verification; it does not construct proofs or call the chain.

- Mixed
  - Circuits/whitelist uses a simple sum-based hash for Merkle trees (documented as a simplification). Not production-safe; needs Poseidon or similar.
  - Rust circuits provide TestConstraintSystem-based validations but examples include both “demo” and “real Nova” flows. The simple demo example explicitly says TODO to replace with real proof generation.

Security/Operational Issues
- Committed secrets: .env and wallet_info.txt include a private key. These must never be in git.
- Built artifacts committed: contracts/out, contracts/cache, contracts/broadcast, sonobe/FundLiquidityVerifier.sol, fund-proof.calldata, etc. These should be ignored or generated.
- Docs inconsistencies: Some files claim “production ready” across the board; in code, only Liquidity Nova verification is actually integrated on-chain. Links to docs/ARECIBO_INTEGRATION.md didn’t exist.

Fixed (this audit)
- Removed inline assembly from _verifyLiquidity and decode with abi.decode for clarity/safety.
- Added docs/ARECIBO_INTEGRATION.md to satisfy README reference and clarify Sonobe vs Arecibo usage.
- Made the demo read contract addresses from env vars (NEXT_PUBLIC_*), avoiding hard-coded addresses.
- Removed committed secrets (.env, contracts/.env, wallet_info.txt).

What’s Real vs. Mocked (by area)
- Sonobe proofs (Liquidity): Real
  - File: sonobe/FundLiquidityVerifier.sol (generated), sonobe/fund-proof.calldata
  - README/END_TO_END_TEST.md flows and calldata size align (28×32=896 bytes; +4-byte selector = 900 bytes file).
- Fund contract → Nova verifier: Real integration
  - File: contracts/src/TokenizedFundManager.sol::_verifyLiquidity calls external verifier via interface.
  - Tests use MockNovaDecider, which is standard testing practice.
- Position limit/Whitelist on-chain: Mocked
  - Files: contracts/src/TokenizedFundManager.sol::_verifyPositionLimit/_verifyWhitelist (TODOs, only non-empty checks).
- Circuits (Rust): Real circuits and tests; Merkle hash is simplified
  - Files: circuits/src/*.rs; whitelist uses addition-based “hash” with a “use Poseidon in production” note.
- Demo: Simulated UI
  - Files: demo/components/DemoSection.tsx, ContractsSection.tsx; previously hard-coded addresses; no on-chain calls.

Notable Inconsistencies to Correct in Docs
- Test counts vary (18/18 vs 22/22; 8/8 vs 10/10). Actual contract tests in TokenizedFundManager.t.sol are 10; circuit tests sum to ~17–18 depending on grouping.
- “Production ready” claims vs. current code state:
  - Liquidity Nova verification: integrated and demonstrably real.
  - Position limit and whitelist verification: not yet integrated with real verifiers on-chain.
  - Demo: simulation only.

Recommended Next Fixes (follow-up)
- Integrate real verifiers for position limit and whitelist:
  - Generate Poseidon-based Merkle circuit and deploy verifier; call it from _verifyWhitelist.
  - Generate position-limit verifier and call it from _verifyPositionLimit.
- Replace simplified Merkle hashing with Poseidon in circuits and re-run proof generation.
- Clean repo: remove committed build artifacts; rely on .gitignore.
- Unify documentation:
  - Clarify what’s live (Liquidity/Nova) vs. pending (Position/Whitelist).
  - Fix mismatched test counts and ensure links exist (this audit adds ARECIBO_INTEGRATION.md).
- Demo: optional — wire up read-only cast/viem calls to the live verifier for a minimal “real” check.

Quick Reality Checklist
- Liquidity ≥ 10%: Real ZK proof via Sonobe/Nova, on-chain verifier integrated.
- Max position ≤ 40%: Circuit exists; on-chain verification not wired (mock in contract).
- Whitelist membership: Circuit exists; on-chain verification not wired (mock in contract); non-cryptographic Merkle hash used in circuits.
- Demo: Simulated; no live proof generation or on-chain calls.

Appendix: Key Files
- Liquidity verifier path: sonobe/FundLiquidityVerifier.sol
- Liquidity calldata: sonobe/fund-proof.calldata
- Fund contract: contracts/src/TokenizedFundManager.sol
- Circuits: circuits/src/*.rs
- Tests: contracts/test/TokenizedFundManager.t.sol

